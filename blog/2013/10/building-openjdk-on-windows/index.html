<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Building OpenJDK on Windows</title>
  <meta name="description" content="Tomorrow I’ll be enjoying an OpenJDK hack session with Martijn Verburg (aka The Diabolical Developer). To prepare for this session he told us to follow the A...">
  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
  
  <link rel="apple-touch-icon" href="/images/avatar.jpg" />

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://royvanrijn.com/blog/2013/10/building-openjdk-on-windows/">
  <link rel="alternate" type="application/rss+xml" title="royvanrijn" href="http://royvanrijn.com/feed/" />


<script>
  <!-- Google Analytics -->
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3219266-2', 'auto');
  ga('send', 'pageview');

  <!-- Disqus Comment Count -->
  var disqus_shortname = 'royvanrijn';
  (function () {
  var s = document.createElement('script'); s.async = true;
  s.type = 'text/javascript';
  s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());

  </script>
  
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

	<a class="site-title" href="/">
	  <img src="/images/header_royvanrijn.jpg" alt="royvanrijn" />
    </a>

    <nav class="site-nav">

      <div class="trigger">
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    
    <div class="page-navigation"> 
      <div class="left"> 
         
          <a href="/blog/2013/10/to-be-or-not-to-be-agile/" title="Previous Post: To be or not to be... Agile!">&laquo; To be or not to be... Agile!</a> 
         
      </div> 
      <div class="right"> 
         
          <a href="/blog/2013/10/openjdk-and-xkcd-random-number/" title="next Post: OpenJDK and XKCD: Random number">OpenJDK and XKCD: Random number &raquo; </a> 
         
      </div> 
      <div class="clear"></div> 
    </div> 
  </header>

  <article class="post-content">

    <div class="post">
      <div class="post-thumbnail">
        
          <img class="post-thumbnail-img" src="/thumbnails/default.jpg"/>
        
      </div>
      <p class="post-meta">
        Written by Roy van Rijn on 
        <span class="date">
          Oct 13, 2013 20:05:14
        </span>
        : <a class="post-comments" href="http://royvanrijn.com/blog/2013/10/building-openjdk-on-windows/#disqus_thread">0 comments</a>
      </p>
      <h1 class="post-title">Building OpenJDK on Windows</h1>
    </div>

    <p>Tomorrow I’ll be enjoying an OpenJDK hack session with Martijn Verburg (aka The Diabolical Developer). To prepare for this session he told us to follow the <a href="https://java.net/projects/adoptopenjdk/pages/AdoptOpenJDKBuildInstructions">AdoptOpenJDK build instructions</a>.</p>

<p>Most <em>cool</em> developers today seem to be using OS/X, but some of us are stuck on Windows laptops. I actually choose to stick with Windows 7 because every single client I’ve worked for has Windows workstations and only require the application to run on Windows. But anyway Martijn said: <em>“Getting OpenJDK to build on Linux/Mac would be easy, Windows can be dicey”</em></p>

<p>With a bit of Googling and some small problems I’ve got it working just fine on my Windows 7 (64 bit). Most information I got was from <a href="https://weblogs.java.net/blog/simonis/archive/2011/10/28/yaojowbi-yet-another-openjdk-windows-build-instruction">this</a> write-up, but I encountered some problems and could skip some steps I didn’t need.</p>

<p>All the tools mentioned are <strong>free</strong>, but you <em>will</em> have to install some Microsoft Visual C++ packages to compile (which most Java programmers try to avoid).</p>

<h1 id="windows-sdk-for-windows-71">Windows SDK for Windows 7.1</h1>

<p>Instead of the blogpost above mentioning this step second, I recommend doing it first. If you install VisualC++ 2010 Express first this step might fail with some weird error. The solution? Uninstall VisualC++ 2010 Express and first install Windows SDK for Windows 7.1.</p>

<p>So go here and install: <a href="http://www.microsoft.com/download/en/details.aspx?id=8279">http://www.microsoft.com/download/en/details.aspx?id=8279</a></p>

<h1 id="microsoft-visualc-2010-express">Microsoft VisualC++ 2010 Express</h1>

<p>Next install VisualC++ 2010 Express (beware, Microsoft tries to install another version, pick 2010 Express):<br />
<a href="http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express">http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express</a><br />
And next Windows Imaging Component (64-bit):<br />
<a href="http://www.microsoft.com/download/en/details.aspx?displaylang=en&amp;id=1385">http://www.microsoft.com/download/en/details.aspx?displaylang=en&amp;id=1385</a></p>

<h1 id="cygwin-64-bit">Cygwin (64 bit)</h1>

<p>For some reason I ran into problems early on using the 64 bit Cygwin, so I decided to install the 64 bit version as well. This worked, so I recommend doing this.<br />
During the installation you’ll need to add some development packages:</p>

<ul>
  <li>binutils</li>
  <li>cpio</li>
  <li>diffutils</li>
  <li>file</li>
  <li>gawk</li>
  <li>gcc-core</li>
  <li>m4</li>
  <li>unzip</li>
  <li>zip</li>
</ul>

<p>I might have forgotten one or two, this will probably popup during the ‘configure’ step below. If you find a missing package, please tell me and I’ll update the post.</p>

<h1 id="make">make</h1>

<p>The version of ‘make’ that is packaged with Cygwin doesn’t work with OpenJDK. Instead we need to download the source from <a href="http://ftp.gnu.org/gnu/make/">http://ftp.gnu.org/gnu/make/</a>. I picked version 3.82 (this one is mentioned on the OpenJDK page). I downloaded and unzipped the source code here: <strong>C:\Projects\OpenJDK\make-3-82</strong></p>

<p>To compile, fire up Cygwin and type:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ cd /cygdrive/c/Projects/OpenJDK/make-3.82
$ ./configure
$ make</code></pre></figure>

<p>Now you could take the generated ‘make.exe’ and place it into the Cygwin bin directory, but this isn’t needed.</p>

<h1 id="freetype">freetype</h1>

<p>Next we need to have Freetype, this step is done exacly like descriped <a href="https://weblogs.java.net/blog/simonis/archive/2011/10/28/yaojowbi-yet-another-openjdk-windows-build-instruction">here</a>. Only do the ‘Freetype’ chapter generating the lib and dll.</p>

<p>Once you’ve generated the lib+dll, make a new directory (I used <strong>C:\Projects\OpenJDK\freetype</strong>). Add the ‘include’ directory from the freetype source code used in the step before. Also create a ‘lib’ directory and place the generated lib and dll in it.</p>

<h1 id="hgantjdk7">Hg/Ant/JDK7</h1>

<p>The other article mentions you’ll need to install TortoiseHg, Apache Ant and a current JDK 7 (as bootstrap). I didn’t have to do this because I already had all three installed. But please go ahead, they are probably needed:</p>

<ul>
  <li><a href="http://tortoisehg.bitbucket.org/download">TortoiseHg</a></li>
  <li><a href="http://ant.apache.org/bindownload.cgi">Apache Ant</a></li>
  <li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK 7</a> (make sure this JDK 7, 64 bit, is set as JAVA_HOME)</li>
</ul>

<h1 id="getting-openjdk-sources">Getting OpenJDK sources</h1>

<p>The other article mentions a lot of PATH requirements that need to be set. I didn’t encounter this at all because I configured my build in another way. First we’ll need to get the OpenJDK source code.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ cd /cygdrive/C/Projects/OpenJDK/
$ mkdir jdk8_tl
$ hg clone http://hg.openjdk.java.net/jdk8/tl jdk8_tl
$ cd jdk8_tl
$ ./get_source.sh</code></pre></figure>

<p>This will create a new directory: /cygdrive/C/Projects/OpenJDK/jdk8_tl with all the sources!</p>

<h1 id="configure">Configure</h1>

<p>Now we need to configure a build for OpenJDK. Instead of just calling ‘./configure’ we’ll need to add a few extra options, we’ll need to point it to the correct MAKE directory and we need to include our custom build freetype.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">./configure MAKE=/cygdrive/C/Projects/OpenJDK/make-3.82/make.exe with_freetype=/cygdrive/C/Projects/OpenJDK/freetype</code></pre></figure>

<p>This will throw a lot of warnings, but in the end it should print something like this:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">* OpenJDK target: OS: windows, CPU architecture: x86, address length: 64

Tools summary:
* Environment:    cygwin version 1.7.25(0.270/5/3) (root at /cygdrive/c/Development/cygwin64)
* Boot JDK:       java version &quot;1.7.0_40&quot;  Java(TM) SE Runtime Environment (build 1.7.0_40-b43)  Java HotSpot(TM) 64-Bit Server VM (build 24.0-b56, mixed mode)  (at /cygdrive/c/progra~1/java/jdk17~1.0_4)
* C Compiler:     Microsoft CL.EXE version 16.00.30319.01 (at /cygdrive/c/progra~2/micros~1.0/vc/bin/amd64/cl)
* C++ Compiler:   Microsoft CL.EXE version 16.00.30319.01 (at /cygdrive/c/progra~2/micros~1.0/vc/bin/amd64/cl)

Build performance summary:
* Cores to use:   7
* Memory limit:   16373 MB
* ccache status:  not available for your system</code></pre></figure>

<p>After the configure step you should have a new build directory added.<br />
Mine was located at: <strong>/cygdrive/C/Projects/OpenJDK/jdk8_tl/build/windows-x86_64-normal-server-release</strong></p>

<h1 id="build-it">Build it</h1>

<p>The next thing I did was to build everything, this can take anywhere from 10 to 40 minutes, my build took 20 minutes.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ cd /cygdrive/C/Projects/OpenJDK/jdk8_tl
$ /cygdrive/C/Projects/OpenJDK/make-3.82/make.exe clean images</code></pre></figure>

<p>After a long wait and a lot of warnings and messages it says it created your very own JDK 8 build. Time to give it a try:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ cd /cygdrive/C/Projects/OpenJDK/jdk8_tl
$ cd build/windows-x86_64-normal-server-release/images/j2sdk-image
$ bin/java -version</code></pre></figure>

<p><img src="/images/814989381.jpg" alt="OpenJDK build completed" /></p>

<p><strong>It worked!</strong></p>

<p>Like I said before, I encountered some problems and errors along the way. Most involved the wrong Cygwin (32 bit), this caused bash to crash (STATUS_ACCESS_VIOLATION) during the configure phase. Also I ran into a problem installing ‘Microsoft SDK for Windows 7.1’ which required me to first uninstall Microsoft VisualC++ 2010. Another problem was not installing ‘diff’ in Cygwin (diffutils) so the build found some other diff.exe (from Git?) which gave differences during the actual build causing it to stop.</p>

<p>I might have forgotten to write down some step, if you encounter any problem (and solve them) please tell me so I can update this post!</p>

<h1 id="todo">Todo</h1>

<p>One thing I should add is ‘<strong>ccache</strong>’. This tool greatly improves the build speed because it caches all unchanged classes/files. It was in Cygwin (32 bit) but it is missing in Cygwin (64 bit)… I’ll have to compile and install it myself. This is one thing I haven’t tried yet, but I probably should do!</p>

<p><strong>Update:</strong> I’ve tried compiling and using ccache-3.1.9, but this broke the build. I might try different versions but for now I’ll just skip ‘clean’-ing altogether :-)</p>


    
  </article>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'royvanrijn';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-wrapper">
      
      <div class="footer-wrapper-content">
      
        <a href="https://www.linkedin.com/profile/view?id=10356027">
          <i class="svg-icon linkedin"></i>
        </a>
      
        <a href="http://stackoverflow.com/users/442274/roy-van-rijn">
          <i class="svg-icon stackoverflow"></i>
        </a>

        <a href="https://github.com/royvanrijn">
          <i class="svg-icon github"></i>
        </a>

        <a href="https://twitter.com/royvanrijn">
          <i class="svg-icon twitter"></i>
        </a>
          
        <a href="/feed/index.xml">
          <i class="svg-icon rss"></i>
        </a>
	  </div>
    
    </div>

  </div>

</footer>


  </body>

</html>
