<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Corewars - SUBLEQ interpreter</title>
  <meta name="description" content="In my previous blogpost I talked about Corewars and the Redcode language. But instead of playing the game, you can do a lot more with the programming languag...">
  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
  
  <link rel="apple-touch-icon" href="/images/avatar.jpg" />

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://royvanrijn.com/blog/2009/12/corewar-subleq-interpreter/">
  <link rel="alternate" type="application/rss+xml" title="royvanrijn" href="http://royvanrijn.com/feed/" />
  
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

	<a class="site-title" href="/">
	  <img src="/images/header_royvanrijn.jpg" alt="royvanrijn" />
    </a>

    <nav class="site-nav">

      <div class="trigger">
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    
    <div id="page-navigation"> 
      <div class="left"> 
         
          <a href="/blog/2009/12/corewars-an-introduction-to-hostile-programming/" title="Previous Post: Corewars - An Introduction to Hostile Programming">&laquo; Corewars - An Introduction to Hostile Programming</a> 
         
      </div> 
      <div class="right"> 
         
          <a href="/blog/2009/12/brainfck-in-redcode/" title="next Post: Corewars - Brainf*ck">Corewars - Brainf*ck &raquo; </a> 
         
      </div> 
      <div class="clear">&nbsp;</div> 
    </div> 

    <h1 class="post-title">Corewars - SUBLEQ interpreter</h1>
    <p class="post-meta">
    	Dec 2, 2009 10:00:26
    </p>
  </header>

  <article class="post-content">
    <p>In my previous blogpost I talked about Corewars and the Redcode language. But instead of playing the game, you can do a lot more with the programming language. John Metcalf posted a blog about <a href="http://retrocode.blogspot.com/2009/01/ultimate-risc-one-instruction-set.html" alt="link to blog post">OISC</a> (One Instruction Set Computers). He decided to implement the RSSB algorithm, so I took on the challenge of implementing SUBLEQ, another single instruction set computer.</p>
<p>And here is the result:</p>
<p><!--more--></p>
<div class="highlight"><pre><code class="language-brainfuck" data-lang="brainfuck"><span class="c">;</span><span class="nb">-----------------------------------------------</span><span class="c"></span>
<span class="c">;redcode</span><span class="nb">-</span><span class="c">94odd</span>
<span class="c">;name SUBLEQ Hello World</span>
<span class="c">;author Roy van Rijn</span>
<span class="c">;assert 1</span>
<span class="c">;</span><span class="nb">-----------------------------------------------</span><span class="c"></span>
<span class="c">;Implementation of the OISC SUBLEQ interpreter</span><span class="nt">.</span><span class="c"></span>
<span class="c">; All instructions take 3 lines:</span>
<span class="c">; dat A</span><span class="nt">,</span><span class="c">0</span>
<span class="c">; dat B</span><span class="nt">,</span><span class="c">0</span>
<span class="c">; dat C</span><span class="nt">,</span><span class="c">0</span>
<span class="c">;</span>
<span class="c">; The interpreter works as following:</span>
<span class="c">;</span>
<span class="c">; Substract A from B</span>
<span class="c">; If B is less or equal to zero jump to C</span>
<span class="c">; Else go to the next instruction (</span><span class="nb">+</span><span class="c">3)</span>
<span class="c">;</span>
<span class="c">; If the jump is to HALT (</span><span class="nb">-</span><span class="c">1) the program will halt</span>
<span class="c">; If the substraction is OUT (</span><span class="nb">-</span><span class="c">2) the program will output the amount substracted</span>
<span class="c">;</span><span class="nb">-----------------------------------------------</span><span class="c"></span>
<span class="c">HALT   equ </span><span class="nb">-</span><span class="c">1</span>
<span class="c">OUT    equ </span><span class="nb">-</span><span class="c">2</span>

<span class="c">;Pointers used by program:</span>
<span class="c">EQ     dat PROGRAM</span><span class="nb">-</span><span class="c">1      </span><span class="nt">,</span><span class="c"> PROGRAM</span>
<span class="c">PTR    dat PROGRAM        </span><span class="nt">,</span><span class="c"> PROGRAM</span><span class="nb">+</span><span class="c">1</span>
<span class="c">RESETV dat PROGRAM</span><span class="nb">-</span><span class="c">SUBSTR </span><span class="nt">,</span><span class="c"> PROGRAM</span><span class="nb">-</span><span class="c">SUBSTR ;reset values</span>
<span class="c">NEXTV  dat #3             </span><span class="nt">,</span><span class="c"> #3</span>

<span class="c">;Print to command line:</span>
<span class="c">PRINT  mov</span><span class="nt">.</span><span class="c">ab *SUBSTR     </span><span class="nt">,</span><span class="c"> #0</span>
<span class="c">       mov</span><span class="nt">.</span><span class="c">b  </span><span class="nb">-</span><span class="c">1          </span><span class="nt">,</span><span class="c"> </span><span class="nv">&lt;</span><span class="c">1000 ;sts</span><span class="nt">.</span><span class="c">b </span><span class="nb">-</span><span class="c">1</span><span class="nt">,</span><span class="c">0 for output</span>

<span class="c">;Reset to absolute values:</span>
<span class="c">NEXT   add</span><span class="nt">.</span><span class="c">f NEXTV        </span><span class="nt">,</span><span class="c"> PTR</span>
<span class="c">RESET  mov</span><span class="nt">.</span><span class="c">f RESETV       </span><span class="nt">,</span><span class="c"> SUBSTR</span>

<span class="c">;Main logic:</span>
<span class="c">START  add</span><span class="nt">.</span><span class="c">a  *PTR        </span><span class="nt">,</span><span class="c"> SUBSTR</span>
<span class="c">       add</span><span class="nt">.</span><span class="c">ab </span><span class="nv">&gt;</span><span class="c">PTR        </span><span class="nt">,</span><span class="c"> SUBSTR</span>
<span class="c">       mov</span><span class="nt">.</span><span class="c">a  @PTR        </span><span class="nt">,</span><span class="c"> NEWPTR</span>

<span class="c">;Check if output is OUT</span><span class="nt">,</span><span class="c"> print and go to next instruction:</span>
<span class="c">       mov</span><span class="nt">.</span><span class="c">a  </span><span class="nv">&lt;</span><span class="c">PTR        </span><span class="nt">,</span><span class="c"> 1</span>
<span class="c">       sne</span><span class="nt">.</span><span class="c">ab #0          </span><span class="nt">,</span><span class="c"> #OUT</span>
<span class="c">       jmp    PRINT</span>

<span class="c">;Substract and determine if the value </span><span class="nv">&lt;</span><span class="c">= 0</span>
<span class="c">SUBSTR sub</span><span class="nt">.</span><span class="c">a  PROGRAM     </span><span class="nt">,</span><span class="c"> PROGRAM</span>
<span class="c">       slt</span><span class="nt">.</span><span class="c">a  #CORESIZE/2 </span><span class="nt">,</span><span class="c"> @</span><span class="nb">-</span><span class="c">1</span>
<span class="c">       jmn</span><span class="nt">.</span><span class="c">ba NEXT        </span><span class="nt">,</span><span class="c"> @</span><span class="nb">-</span><span class="c">2</span>

<span class="c">;Jump to new address:</span>
<span class="c">NEWPTR mov</span><span class="nt">.</span><span class="c">ab #0          </span><span class="nt">,</span><span class="c"> #0</span>
<span class="c">       mov</span><span class="nt">.</span><span class="c">f  NEWPTR      </span><span class="nt">,</span><span class="c"> PTR</span>
<span class="c">       add</span><span class="nt">.</span><span class="c">f  EQ          </span><span class="nt">,</span><span class="c"> PTR</span>
<span class="c">       seq</span><span class="nt">.</span><span class="c">ab NEWPTR      </span><span class="nt">,</span><span class="c"> #HALT</span>

<span class="c">;Check for HALT (jump to DAT</span><span class="nb">-</span><span class="c">PROGRAM)</span>
<span class="c">       jmp RESET</span>

<span class="c">LABEL</span>
<span class="c">PROGRAM</span>

<span class="c">;</span><span class="nb">-----------------------------------------------</span><span class="c"></span>
<span class="c">;Translated version of the Hello World program from:</span>
<span class="c">;http://mozaika</span><span class="nt">.</span><span class="c">com</span><span class="nt">.</span><span class="c">au/oleg/subleq/</span>


<span class="c">dat A</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat A</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 3</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat p</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 6</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat A</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 9</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat A</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>

<span class="c">A dat PROGRAM </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat OUT </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 15</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat m1</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat p</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 18</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat A</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat A</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 21</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat E</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 24</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat A</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 27</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 30</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat b</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat b</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 33</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat p</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 36</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat b</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 39</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 42</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat E</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat b</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 48</span><span class="nt">,</span><span class="c">0 ;?</span><span class="nb">+</span><span class="c">3</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 51</span><span class="nt">,</span><span class="c">0 ;?</span><span class="nb">+</span><span class="c">3</span>

<span class="c">dat p</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat A</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 54</span><span class="nt">,</span><span class="c">0 ;?</span><span class="nb">+</span><span class="c">3</span>

<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat Z</span><span class="nb">-</span><span class="c">LABEL </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 0</span><span class="nt">,</span><span class="c">0</span>

<span class="c">dat 0 </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat 0 </span><span class="nt">,</span><span class="c">0</span>
<span class="c">dat </span><span class="nb">-</span><span class="c">1</span><span class="nt">,</span><span class="c">0</span>

<span class="c">;data</span>
<span class="c">p dat H</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>
<span class="c">Z dat 0</span><span class="nt">,</span><span class="c">0</span>
<span class="c">m1 dat </span><span class="nb">-</span><span class="c">1</span><span class="nt">,</span><span class="c">0</span>
<span class="c">b dat 0</span><span class="nt">,</span><span class="c">0</span>
<span class="c">H dat 72</span><span class="nt">,</span><span class="c">0 ;:H</span>
<span class="c">dat 101</span><span class="nt">,</span><span class="c">0 ; e</span>
<span class="c">dat 108</span><span class="nt">,</span><span class="c">0 ; l</span>
<span class="c">dat 108</span><span class="nt">,</span><span class="c">0 ; l</span>
<span class="c">dat 111</span><span class="nt">,</span><span class="c">0 ; o</span>
<span class="c">dat 32</span><span class="nt">,</span><span class="c">0 ; space</span>
<span class="c">dat 87</span><span class="nt">,</span><span class="c">0 ; W</span>
<span class="c">dat 111</span><span class="nt">,</span><span class="c">0 ; o</span>
<span class="c">dat 114</span><span class="nt">,</span><span class="c">0 ; r</span>
<span class="c">dat 108</span><span class="nt">,</span><span class="c">0 ; l</span>
<span class="c">dat 100</span><span class="nt">,</span><span class="c">0 ; d</span>
<span class="c">E dat E</span><span class="nb">-</span><span class="c">LABEL</span><span class="nt">,</span><span class="c">0</span>

<span class="c">end START</span>
<span class="c">;</span><span class="nb">-----------------------------------------------</span><span class="c"></span></code></pre></div>

  </article>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'royvanrijn';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-wrapper">
      
        <a href="https://www.linkedin.com/profile/view?id=10356027">
          <i class="svg-icon linkedin"></i>
        </a>
      
        <a href="http://stackoverflow.com/users/442274/roy-van-rijn">
          <i class="svg-icon stackoverflow"></i>
        </a>

        <a href="https://github.com/royvanrijn">
          <i class="svg-icon github"></i>
        </a>

        <a href="https://twitter.com/royvanrijn">
          <i class="svg-icon twitter"></i>
        </a>
          
        <a href="/feed/index.xml">
          <i class="svg-icon rss"></i>
        </a>
    
    </div>

  </div>
  
  <script> <!-- Google Analytics -->
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3219266-2', 'auto');
  ga('send', 'pageview');

  </script>

</footer>


  </body>

</html>
