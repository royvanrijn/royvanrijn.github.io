<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Placement of circle over points</title>
  <meta name="description" content="For the Queue ICPC programming game Capture I ran into a geometrical problem.While programming my little robot I wanted to have an algorithm calculate this f...">
  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
  
  <link rel="apple-touch-icon" href="/images/avatar.jpg" />

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://royvanrijn.com/blog/2010/01/placement-of-circle-over-points/">
  <link rel="alternate" type="application/rss+xml" title="royvanrijn" href="http://royvanrijn.com/feed/" />
  
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

	<a class="site-title" href="/">
	  <img src="/images/header_royvanrijn.jpg" alt="royvanrijn" />
    </a>

    <nav class="site-nav">

      <div class="trigger">
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    
    <div class="page-navigation"> 
      <div class="left"> 
         
          <a href="/blog/2010/01/i-hate-printers/" title="Previous Post: I hate printers">&laquo; I hate printers</a> 
         
      </div> 
      <div class="right"> 
         
          <a href="/blog/2010/02/handling-null-in-java/" title="next Post: Handling null in Java">Handling null in Java &raquo; </a> 
         
      </div> 
      <div class="clear"></div> 
    </div> 

    <h1 class="post-title">Placement of circle over points</h1>
    <p class="post-meta">
    	Jan 27, 2010 15:02:57
    	 - <a class="post-comments" href="http://royvanrijn.com/blog/2010/01/placement-of-circle-over-points/#disqus_thread"></a>
    </p>
  </header>

  <article class="post-content">
    <p>For the Queue ICPC programming game <a href="http://queue.acm.org/icpc/index.cfm">Capture</a> I ran into a geometrical problem.<br />
While programming my little robot I wanted to have an algorithm calculate this for me:</p>


<ol>
<li>I have a field with 122 points</li>
<li>I have a circle of fixed size</li>
</ol>
<p>How do I calculate where to put the circle so it encapsulates the most points?</p>
<p>This is what I came up with, three algorithms:<br />
<!--more--></p>
<h1>Algorithm #1: Centerpoint</h1>
<p>The first algorithm was created as a test. It doesn't find the perfect solution, but gives a decent solution.<br />
First I loop over all the points, and I check if there are points located at <strong>CIRCLE_RADIUS</strong> length from our point. This returns a score. The best point has a lot of other points nearby.</p>
<p>This algorithm is very quick, but it has a huge disadvantage, the circle will always have one of our points as center.</p>
<p>It will never yield the perfect solution... In the following picture this algorithm produces the <span style="color:rgb(0,255,0);">green</span> circle:</p>
<p><a href="/images/clusterCalculations.png"><img src="/images/clusterCalculations.png" alt="Picture of points and three calculated circles" width="201" height="208" /></a></p>
<h1>Algorithm #2: Heatmap</h1>
<p>The next idea I got was based on a heatmap. It is very computer heavy, but it will generate the best solution.</p>
<p>It works like this (psuedocode):</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">for</span><span class="o">(</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">FIELD_SIZE</span> <span class="o">)</span>
	<span class="k">for</span><span class="o">(</span> <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">FIELD_SIZE</span> <span class="o">)</span>
		<span class="n">Point</span> <span class="n">pixel</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Point</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);</span>
		<span class="n">pixelScore</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="k">for</span><span class="o">(</span> <span class="n">Point</span> <span class="nl">point:</span> <span class="n">points</span> <span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span><span class="o">(</span> <span class="n">point</span><span class="o">.</span><span class="na">distance</span><span class="o">(</span><span class="n">pixel</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">CIRCLE_RADIUS</span><span class="o">*</span><span class="mi">2</span> <span class="o">)</span> <span class="o">{</span>
				<span class="n">pixelScore</span><span class="o">++;</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>The pixel with the best score is used in most circles. Thus, this would need to be the center of our circle!</p>
<p>In the image above you can see the resulting heatmap, and the <span style="color:rgb(0,255,255);">cyan</span> circle is placed on the best possible pixel.</p>
<p>(In most cases, there are more then one 'best pixels', which one you choose doesn't matter)</p>
<h1>Algorithm #3: Bron-Kerbosch-myself</h1>
<p>The heatmap algorithm, mentioned above, takes a LOT of processing time and is far from the most efficient algorithm. For the Queue ICPC contest there is a time limit for each calculation, and I need it to speed up!</p>
<p>So I started to wonder:</p>
<p>- What do all the points in the perfect circle have in common?</p>
<p>Well, they all have a maximum distance to each other of <strong>CIRCLE_RADIUS * 2</strong>. </p>
<p>So I started to play with graph algorithms.</p>
<p>The lines you see in the image above are all the points that can be connected with a maximum length of <strong>CIRCLE_RADIUS * 2</strong>. All the lines show points that could possibly be in the same circle together.<br />
Then I googled a bit and found the term '<a href="http://en.wikipedia.org/wiki/Clique_(graph_theory)">clique</a>'. A clique is a group of points that all point to each other, just what we want with the graph shown in the picture!</p>
<p>When I searched a little further I came across the <a href="http://en.wikipedia.org/wiki/Bron%E2%80%93Kerbosch_algorithm">Bron-Kerbosch algorithm</a>. It finds the perfect maximum clique for a given undirected graph! Again, just what we want!</p>
<p>Here is the pseudocode (from Wikipedia):</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">BronKerbosch1</span><span class="o">(</span><span class="n">R</span><span class="o">,</span><span class="n">P</span><span class="o">,</span><span class="n">X</span><span class="o">):</span>
       <span class="k">if</span> <span class="n">P</span> <span class="n">and</span> <span class="n">X</span> <span class="n">are</span> <span class="n">both</span> <span class="nl">empty:</span>
           <span class="n">report</span> <span class="n">R</span> <span class="n">as</span> <span class="n">a</span> <span class="n">maximal</span> <span class="n">clique</span>
       <span class="k">for</span> <span class="n">each</span> <span class="n">vertex</span> <span class="n">v</span> <span class="n">in</span> <span class="nl">P:</span>
           <span class="n">BronKerbosch1</span><span class="o">(</span><span class="n">R</span> <span class="err">⋃</span> <span class="o">{</span><span class="n">v</span><span class="o">},</span> <span class="n">P</span> <span class="err">⋂</span> <span class="n">N</span><span class="o">(</span><span class="n">v</span><span class="o">),</span> <span class="n">X</span> <span class="err">⋂</span> <span class="n">N</span><span class="o">(</span><span class="n">v</span><span class="o">))</span>
           <span class="n">P</span> <span class="o">:=</span> <span class="n">P</span> <span class="err">\</span> <span class="o">{</span><span class="n">v</span><span class="o">}</span>
           <span class="n">X</span> <span class="o">:=</span> <span class="n">X</span> <span class="err">⋃</span> <span class="o">{</span><span class="n">v</span><span class="o">}</span></code></pre></div>
<p>But I ran into a little problem, I'd made a false assumption... If you have a triangle of three points, with all legs size N, and then draw a circle from the center... none of the points fall into the circle.</p>
<p><img src="/images/triangleFailure.png" alt="Picture of a circle inside a triangle, where the legs of the triangle are the circle's diameter. This causes all the corners to fall outside the circle." /></p>
<p>Now I tried two ways to solve this, the first one is to use a smaller distance in the graph. If you only select points that are located <strong>(cosine(30) * CIRCLE_RADIUS * 2)</strong> every point will eventually fall into our circle. But this could eliminate the perfect circle obviously if two points in the perfect solution are further apart then <strong>(cosine(30) * CIRCLE_RADIUS * 2)</strong>.</p>
<p>Then I desected the Bron-Kerbosch algorithm, and decided to change it a bit. This is what I ended up with:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">BronKerboschVanRijn</span><span class="o">(</span><span class="n">R</span><span class="o">,</span><span class="n">P</span><span class="o">,</span><span class="n">X</span><span class="o">):</span>
       <span class="k">if</span> <span class="n">P</span> <span class="n">and</span> <span class="n">X</span> <span class="n">are</span> <span class="n">both</span> <span class="nl">empty:</span>
           <span class="n">report</span> <span class="n">R</span> <span class="n">as</span> <span class="n">a</span> <span class="n">maximal</span> <span class="n">clique</span>
       <span class="k">for</span> <span class="n">each</span> <span class="n">vertex</span> <span class="n">v</span> <span class="n">in</span> <span class="nl">P:</span>
           <span class="n">BronKerbosch1</span><span class="o">(</span><span class="n">R</span> <span class="err">⋃</span> <span class="o">{</span><span class="n">v</span><span class="o">},</span> <span class="n">InCircle</span><span class="o">({</span><span class="n">R</span><span class="o">,</span><span class="n">v</span><span class="o">},</span> <span class="n">P</span><span class="o">),</span> <span class="n">InCircle</span><span class="o">({</span><span class="n">R</span><span class="o">,</span><span class="n">v</span><span class="o">},</span> <span class="n">X</span><span class="o">))</span>
           <span class="n">P</span> <span class="o">:=</span> <span class="n">P</span> <span class="err">\</span> <span class="o">{</span><span class="n">v</span><span class="o">}</span>
           <span class="n">X</span> <span class="o">:=</span> <span class="n">X</span> <span class="err">⋃</span> <span class="o">{</span><span class="n">v</span><span class="o">}</span>
           
   <span class="n">InCircle</span><span class="o">(</span><span class="n">A</span><span class="o">,</span> <span class="n">B</span><span class="o">):</span>
       <span class="n">calculate</span> <span class="n">minimal</span> <span class="n">enclosing</span> <span class="n">circle</span> <span class="k">for</span> <span class="n">points</span> <span class="n">A</span>
       <span class="k">return</span> <span class="n">all</span> <span class="n">B</span> <span class="n">that</span> <span class="nf">are</span> <span class="o">(</span><span class="n">euclidean</span> <span class="n">distance</span><span class="o">)</span> <span class="n">inside</span> <span class="n">A</span></code></pre></div>
<p>This returns all the maximal cliques that fall into our circle, and we are always sure they fall into our circle..! I think this will always generate the perfect solution, just as the heat map. In this the above picture, this algorithm produces the <span style="color:rgb(255,0,0);">red</span> circle.</p>
<p>It already is light years faster then the heat map algorithm, but I still need a bit more speed. I'm still struggling to improve my implementation, like trying to use a pivot as bronKerbosch2 (see wikipedia again) does.</p>
<h1>Algorithm #4: ???</h1>
<p>For some reason I still fail to believe I'm the first person in the world to tackle this problem. But I haven't been able to find an algorithm for this. Some people recommended using a <a href="http://en.wikipedia.org/wiki/Sweep_line_algorithm">sweeping algorithm</a> but I don't understand how this is used to find the circle's location. Others pointed me to Voronoi maps...</p>
<p>So if you have any suggestions, or know the algorithm I'm looking for, please add a comment :-)</p>

  </article>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'royvanrijn';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-wrapper">
      
      <div class="footer-wrapper-content">
      
        <a href="https://www.linkedin.com/profile/view?id=10356027">
          <i class="svg-icon linkedin"></i>
        </a>
      
        <a href="http://stackoverflow.com/users/442274/roy-van-rijn">
          <i class="svg-icon stackoverflow"></i>
        </a>

        <a href="https://github.com/royvanrijn">
          <i class="svg-icon github"></i>
        </a>

        <a href="https://twitter.com/royvanrijn">
          <i class="svg-icon twitter"></i>
        </a>
          
        <a href="/feed/index.xml">
          <i class="svg-icon rss"></i>
        </a>
	  </div>
    
    </div>

  </div>
  
  <script>
  
  <!-- Google Analytics -->
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3219266-2', 'auto');
  ga('send', 'pageview');

  <!-- Disqus Comment Count -->
  var disqus_shortname = 'royvanrijn'; // required: replace example with your forum shortname
  (function () {
  var s = document.createElement('script'); s.async = true;
  s.type = 'text/javascript';
  s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());

  </script>

</footer>


  </body>

</html>
